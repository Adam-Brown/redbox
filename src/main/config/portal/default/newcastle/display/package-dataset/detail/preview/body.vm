#macro(sectionHeading $heading)
<span class="accordion-header">$heading</span>
#end
#macro(displayFirst $key $name)
    <dt>$name</dt>
    <dd>$self.getFirst($key)</dd>
#end
#macro(displayUrl $name $hrefField $labelField)
    <dt>$name</dt>
    <dd><a href="$self.getFirst($hrefField)" target="_blank">$self.getFirst($labelField)</a></dd>
#end
#macro(displayList $baseKey $name)
    <dt>$name</dt>
    <dd>
        #set($prefixList = $self.getList($baseKey))
        <ol>
        #foreach($key in $prefixList.keySet())
            #foreach($value in $prefixList.get($key))
            <li>$self.escapeHtml($value)</li>
            #end
        #end
        </ol>
    </dd>
#end
#macro(displayUrlList $key $name $hrefField $labelField)
    <dt>$name</dt>
    <dd>
        #set($urlList = $self.getList($key))
        <ol>
        #foreach($key in $urlList.keySet())
            #set($url = $urlList.get($key))
            #set($href = $url.get($hrefField))
            #set($label = $url.get($labelField))
            #if("$!label"!="")
                <li>
                #if("$!href"!="")
                    <a href="$self.escapeHtml($!href)">$self.escapeHtml($!label)</a>
                #else
                    $self.escapeHtml($!label)
                #end
                </li>
            #end
        #end
        </ol>
    </dd>
#end
#if($page.authentication.is_logged_in())
    #set ($vPid = $parent.getProperty("vitalPid"))
    #set ($vHandle = $parent.getProperty("vitalHandle"))
    #if ($vPid != $nullValue)
<div class="vital-id">
    This object has already been published to VITAL '<strong>$vPid</strong>'.
    #if ($vHandle != $nullValue)
    (ACTIVE, Handle: <a href="$vHandle">$vHandle</a>)
    #else
    (INACTIVE, waiting for handle)
    #end
</div>
    #end
#end
<div id="toggle-accordion" class="toggle-accordion">
    <span id="toggle-accordion-icon" class="ui-icon ui-icon-triangle-1-e"></span>
    <span id="toggle-accordion-text">Show all sections</span>
</div>
<div class="accordion">
    #parseDisplayTemplate("detail/preview/sections/general.vm")
    #parseDisplayTemplate("detail/preview/sections/coverage.vm")
    #parseDisplayTemplate("detail/preview/sections/description.vm")
    #parseDisplayTemplate("detail/preview/sections/people.vm")
    #parseDisplayTemplate("detail/preview/sections/subject.vm")
    #parseDisplayTemplate("detail/preview/sections/rights.vm")
    #parseDisplayTemplate("detail/preview/sections/management.vm")
    #parseDisplayTemplate("detail/preview/sections/attach.vm")
    #if($page.authentication.is_logged_in())
        #parseDisplayTemplate("detail/preview/sections/notes.vm")
        #parseDisplayTemplate("detail/preview/sections/request.vm")
    #end
    #if($page.authentication.is_admin())
        #parseDisplayTemplate("detail/preview/sections/admin.vm")
    #end
</div>
<script type="text/javascript">
$(function(){
    function addAccordion() {
        $(".accordion").accordion({
            autoHeight:false,
            clearStyle:true,
            collapsible:false,
            header:".accordion-header"
        });
    }
    $("#toggle-accordion").click(function(){
        if ($(".ui-accordion").length > 0) {
            $(".accordion").fadeOut(function(){
                $(this).accordion("destroy");
                $(".accordion-header").each(function() {
                    $(this).addClass("accordion-reset");
                });
                $(this).fadeIn();
            });
            $("#toggle-accordion-text").text("Show sections individually");
        } else {
            $(".accordion").fadeOut(function(){
                addAccordion();
                $(".accordion-header").each(function() {
                    $(this).removeClass("accordion-reset");
                });
                $(this).fadeIn();
            });
            $("#toggle-accordion-text").text("Show all sections");
        }
        $("#toggle-accordion-icon").toggleClass("ui-icon-triangle-1-e ui-icon-triangle-1-s");
        return false;
    });
    addAccordion();
});
</script>
