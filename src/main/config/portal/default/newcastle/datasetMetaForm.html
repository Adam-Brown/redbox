
<div class="widget-form" id="main-form">
<input type="hidden" class="form-fields"
       value="title, description,
            rdf:About, dc:title, dc:description,

            dc:creator.0.foaf:Person.foaf:givenName,
            dc:creator.0.foaf:Person.foaf:familyName,
            dc:creator.0.vivo:workEmail,
            vivo:contactInformation.0.foaf:Person.foaf:givenName,
            vivo:contactInformation.0.foaf:Person.foaf:familyName,
            vivo:contactInformation.0.vivo:workEmail,

            vivo:hasSubjectArea.0, vivo:hasSubjectArea.0.skos:prefLabel,
            vivo:freetextKeyword.0,
            dc:rights
       " />
<input type="hidden" class="form-fields-readonly" value="metaList,
       xmlns:dc, xmlns:foaf, xmlns:vivo,
       " />
<input type="hidden" class="form-fields-save-url"
       value="{packageData.portalPath}/actions/manifest.ajax?func=update-package-meta&amp;oid={packageData.oid}" />
<input type="hidden" class="form-fields-submit-url"
       value="{packageData.portalPath}/actions/manifest.ajax?func=update-package-meta&amp;oid={packageData.oid}" />

<input type="hidden" id="metaList" value="[]" />
<input type="hidden" id="xmlns:dc" value="http://dublincore.org/documents/2008/01/14/dcmi-terms/" />
<input type="hidden" id="xmlns:foaf" value="http://xmlns.com/foaf/spec/" />
<input type="hidden" id="xmlns:anzsrc" value="http://purl.org/anzsrc/" />
<input type="hidden" id="xmlns:vivo" value="http://www.bethel.edu/namespaces/vivo" />

<div class="inputscreens changeToTabLayout">
    <h3><a href="#screen1">About</a></h3>
    <div id="screen1" class="inputscreen">
        <div>
            <h1>About</h1>
            <h2><label for="rdf:About">About URI</label></h2>
            <p><input type="text" id="rdf:About" size="80"
                      placeholder="enter title here" autofocus/>
                <label class="validation-err-msg" style="color:red;" for="rdf:About">
                    About URI is required!
                </label>
                <input type="hidden" class="validation-rule"
                       value="for(rdf:About);test(notEmpty);when(onChange);name(about);"/>
            </p>

            <h2><label for="dc:title">Title</label></h2>
            <p><input type="text" id="dc:title" size="80"
                      placeholder="enter title here" />
                <label class="validation-err-msg" style="color:red;" for="dc:title">
                    A title is required!
                </label>
                <input type="hidden" class="validation-rule"
                       value="for(dc:title);test(!='');when(onChange);name(test1);"/>
            </p>

            <h2><label for="dc:description">Description</label></h2>
            <p><textarea rows="6" cols="80" id="dc:description"
                         placeholder="description"></textarea>
            </p>
        </div>
        <div class="tab-nav">
            <span class="next-tab">next-tab</span>
        </div>
    </div>

    <h3><a href="#screen2">People</a></h3>
    <div id="screen2" class="inputscreen">
        <div class="nameLookup-section">
            <!-- <input type="hidden" class="nameLookup-url" value="../proxyGet?url=http://novadev2.newcastle.edu.au:8086/mint/master/opensearch/lookup?searchTerms={searchTerms}"/> -->
            <input type="hidden" class="nameLookup-url" value="../proxyGet?ns=mintPeople&qs=searchTerms%3D{searchTerms}"/>
            <input type="hidden" class="nameLookup-value-ns" value="nl"/>
            <h1>People</h1>

            <h2><label for="dc:creator">Creators</label></h2>
            <table class="input-list sortable">
             <thead>
               <tr class="header-row">
                 <th></th>
                 <th>#</th>
                 <th style="text-align:center;"><label for="dc:creator.1.foaf:Person.foaf:givenName">Given Name</label></th>
                 <th style="text-align:center;"><label for="dc:creator.1.foaf:Person.foaf:familyName">Family Name</label></th>
                 <th></th>
                 <th style="text-align:center;"><label for="dc:creator.1.">Work email</label></th>
                 <th></th>
                 <th style="width:100%;"></th>
               </tr>
             </thead>
             <tfoot>
               <tr>
                  <td></td>
                  <td></td>
                  <td><input class="add-another-item" type="button" value="Add another creator"/></td>
                  <td></td>
                  <td></td>
                </tr>
             </tfoot>
             <tbody>
               <tr class="item-input-display sortable-item">
                 <td><img class="facets-grip" src="../images/icons/grippy.png"/></td>
                 <td class="sort-number">1</td>
                 <td><input type="text" placeholder="given name"
                            class="nameLookup-name nl nl-foaf:firstName"
                            id="dc:creator.0.foaf:Person.foaf:givenName" /></td>
                 <td><input type="text" placeholder="family name" 
                            class="nameLookup-name nl nl-foaf:lastName"
                            id="dc:creator.0.foaf:Person.foaf:familyName"/></td>
                 <td><a href="#" class="nameLookup-lookup">lookup</a></td>
                 <td><input type="text" placeholder="work email" size="60"
                            class="nl nl-vivo:workEmail"
                            id="dc:creator.0.vivo:workEmail"/></td>
                 <td class="delete-item"><a href="#">delete</a></td>
               </tr>
              </tbody>
            </table>

            <h2><label for="vivo:contactInformation">Contact Information</label></h2>
            <table class="input-list sortable">
             <thead>
               <tr class="header-row">
                 <th></th>
                 <th>#</th>
                 <th style="text-align:center;"><label for="vivo:contactInformation.1.foaf:Person.foaf:givenName">Given Name</label></th>
                 <th style="text-align:center;"><label for="vivo:contactInformation.1.foaf:Person.foaf:familyName">Family Name</label></th>
                 <th style="text-align:center;"><label for="vivo:contactInformation.1.">Work email</label></th>
                 <th></th>
                 <th style="width:100%;"></th>
               </tr>
             </thead>
             <tfoot>
               <tr>
                  <td></td>
                  <td></td>
                  <td><input class="add-another-item" type="button" value="Add another contact"/></td>
                  <td></td>
                  <td></td>
                </tr>
             </tfoot>
             <tbody>
               <tr class="item-input-display sortable-item">
                 <td><img class="facets-grip" src="../images/icons/grippy.png"/></td>
                 <td class="sort-number">1</td>
                 <td><input type="text" placeholder="given name"
                           id="vivo:contactInformation.0.foaf:Person.foaf:givenName" /></td>
                 <td><input type="text" placeholder="family name"
                           id="vivo:contactInformation.0.foaf:Person.foaf:familyName"/></td>
                 <td><input type="text" placeholder="work email"
                           id="vivo:contactInformation.0.vivo:workEmail"/></td>
                 <td class="delete-item"><a href="#">delete</a></td>
               </tr>
              </tbody>
            </table>

            <h2><label for="vivo:contactInformation">Mint lookup test</label></h2>
            <table class="input-list sortable">
             <thead>
               <tr class="header-row">
                 <th></th>
                 <th>#</th>
                 <th style="text-align:center;"><label for="vivo:contactInformation.1.foaf:Person.foaf:Name">Name</label></th>
                 <th></th>
                 <th style="width:100%;"></th>
               </tr>
             </thead>
             <tfoot>
               <tr>
                  <td></td>
                  <td></td>
                  <td><input class="add-another-item" type="button" value="Add another contact"/></td>
                  <td></td>
                  <td></td>
                </tr>
             </tfoot>
             <tbody>
               <tr class="item-input-display sortable-item">
                 <td><img class="facets-grip" src="../images/icons/grippy.png"/></td>
                 <td class="sort-number">1</td>
                 <td><input type="text" placeholder="name"
                           id="vivo:contactInformation.0.foaf:Person.foaf:Name" /></td>
                 <td><a class="lookup" href="#">lookup</a></td>
                 <td class="delete-item"><a href="#">delete</a></td>
               </tr>
              </tbody>
            </table>
        </div>
        <div class="tab-nav">
            <span class="prev-tab">prev-tab</span>
            <span class="next-tab">next-tab</span>
        </div>
    </div>

    <h3><a href="#screen3">Keywords</a></h3>
    <div id="screen3" class="inputscreen">
        <div>
            <h1>Keywords</h1>

            <h2>Subject Area</h2>
            <table class="input-list sortable">
                <tfoot>
                    <tr class="item-input">
                        <td>
                            <span class="data-source-drop-down">
                                <!-- <input type="hidden" class="json-data-source-url"
                                       value="../json/anzsrc/for/index.json" /> 
                                <input type="hidden" class="json-data-source-url-lookup"
                                        value="http://localhost:8080/redbox/default/proxyGet?url=http://novadev2.newcastle.edu.au:8086/mint/for/opensearch/lookup?count=999%26level=" />
                                -->
                                <input type="hidden" class="json-data-source-url-lookup"
                                        value="http://localhost:8080/redbox/default/proxyGet?ns=mintFor&qs=count%3D999%26level%3D" />
                                <input type="hidden" class="json-data-top-level-id" value="top"/>
                                <input type="hidden" class="json-data-id-key" value="rdf:about"/>
                                <input type="hidden" class="json-data-label-key" value="skos:prefLabel"/>
                                <input type="text" class="selection-add-label" id="vivo:hasSubjectArea.0.skos:prefLabel" value="[one]" />
                                <input type="text" class="selection-add-id" id="vivo:hasSubjectArea.0" value="[two]" />
                            </span>
                            <button class="item-add selection-add add-unique-only">
                                Add '<span class="selection-add-label"></span>'<!--(id=<span
                                    class="selection-add-id"></span>)-->
                            </button>
                        </td>
                    </tr>
                </tfoot>
                <tbody>
                    <tr class="item-display sortable-item">
                        <td>
                            <img class="facets-grip" src="../images/icons/grippy.png"/>&#160;
                            <span class="sort-number"></span> &#160;
                            <span class="item-display-item"></span>
                            <span class="item-display-item" style="color:lightblue;display:none;"></span>
                            <a class="delete-item" href="#">delete</a>
                        </td>
                    </tr>
                </tbody>
            </table>
            <p>
            </p>

            <h2><label for="vivo:freetextKeyword.1">Freetext Keywords</label></h2>
            <table class="input-list sortable" id="-test">
              <tfoot>
                <tr>
                    <td> </td>
                    <td><input type="button" class="add-another-item" value="Add another keyword"/></td>
                    <td></td>
                </tr>
              </tfoot>
              <tbody>
                <tr class="item-input-display sortable-item">
                    <td class="sort-number"></td>
                    <td><input type="text" placeholder="enter a keyword here" 
                               id="vivo:freetextKeyword.0"/></td>
                    <td class="delete-item"><a href="#">delete</a></td>
                    <td style="width:100%;"/>
                </tr>
              </tbody>
            </table>
        </div>
        <div class="tab-nav">
            <span class="prev-tab">prev-tab</span>
            <span class="next-tab">next-tab</span>
        </div>
    </div>

    <h3><a href="#screen4">Rights</a></h3>
    <div id="screen4" class="inputscreen">
        <div>
            <h1>Rights</h1>

            <h2><label for="dc:rights">Rights</label></h2>
            <p><input id="dc:rights" type="text"  size="80" placeholder="rights"/>
        </div>
        <div class="tab-nav">
            <span class="prev-tab">prev-tab</span>
            <span class="next-tab">next-tab</span>
        </div>
    </div>

    <h3><a href="#screen5">Submit</a></h3>
    <div id="screen5" class="inputscreen">
        <h1>Submit</h1>

        <div>
            <h2>Deposit</h2>
        </div>
        <div>
            <div>
                <!-- <input type="checkbox"/>  -->
            </div>
            <input type="submit" id="update-package" value="Submit" class="form-fields-submit"/>
            <input type="hidden" class="submit-result-func" value="submitted_ok" />
            <p>
                <span class="submitted-result" style="padding-left:2em;font-size:120%;"> </span>
                <label class="validation-err-msg" style="color:red;vertical-align:top;" for="dc:abstract">
                    An abstract is required!
                </label>
            </p>
        </div>
        <div class="tab-nav">
            <span class="prev-tab">prev-tab</span>
        </div>
    </div>
</div>
<div style="margin:2em 1em 1em 2em; ">
    <input type="button" class="form-fields-save" value="Save for later"/>
    <span class="saved-result" style="padding-left:2em;font-size:120%;"> </span>
</div>

<div id="controlbar">
</div>

</div> <!-- widget-form -->

<!-- Moved from above so that it will work in Chrome -->
    <iframe id="uploadframe" name="uploadframe"
            style="display:none; height:8ex; width:80em; border:1px solid red;"/>

<script type="text/javascript">
    var wfUrl = "../arts/painting-workflow";
    function submitted_ok(){
        //alert("Submitted ok " + location.href);
        location.href = location.href.replace("/workflow/", "/detail/");
    }

    function itemSearch(pageNum){
        var portalPath = packageData.portalPath;
        var packagedItems = packageData.packagedItems;
        var searchResults, searchResultsDiv;
        var packagedIds = {};
        var paging = $("#add-items-search-query").parent().find(".paging");
        var pages, query;
        if(!pageNum) pageNum=1;
        $.each(packagedItems, function(i, doc){
            packagedIds[doc.id] = doc.id;
        });
        query=$("#add-items-search-query").val();
        searchResults = $("#search-results");
        searchResultsDiv = searchResults.find("> div").html("");
        searchResults.find("span.result-info").text("searching...");
        paging.html("");

        $.getJSON(wfUrl, {func:"search", query:query, pageNum:pageNum},
            function(data){
                gdata = data;   // for testing only
                var response=data.response;
                var start=1*response.start;
                var rows=1*data.responseHeader.params.rows; // page size
                var docs = response.docs;
                var found = 1*response.numFound;
                var sTo = found;
                if(found)start+=1;
                if(sTo>(start+rows)) sTo=start+rows;
                pages = Math.ceil(found/rows);
                if(pages>1){
                    var ul=$("<ul/>"), li, a, nums=[];
                    nums[pages-1]=0;
                    $.each(nums, function(i){
                        i+=1;
                        if(i==pageNum){
                            li = $("<li class='selected-page'>"+i+"</li>");
                        }else{
                            a = $("<a href='#'>"+i+"</a>");
                            li = $("<li class='select-page'/>");
                            li.append(a);
                            a.click(function(){
                                $("#add-items-search-query").val(query);
                                itemSearch(i);
                                return false;
                            });
                        }
                        ul.append(li);
                    });
                    paging.append(ul);
                }
                searchResults.find("span.result-info").text(
                    found?("showing "+start+" to "+(sTo)+" of "+found+" items"):"No results found"
                );

                if(found==0){
                    searchResultsDiv.append("No results found");
                }
                searchResultsDiv.show();
                searchResults.find(".showhide").text("(hide)").show().unbind().click(function(){
                    var i=searchResults.find(".showhide");
                    if(i.text()=="(show)"){
                        searchResultsDiv.show();
                        i.text("(hide)");
                    }else{
                        searchResultsDiv.hide();
                        i.text("(show)");
                    }
                });

                $.each(docs, function(i, doc){
                    var div, h3, checkbox, id, title, description, thumbnail;
                    try{
                        id = doc.id;
                        title = doc.dc_title[0];
                        if(doc.dc_description){
                            description = doc.dc_description[0]
                        }else{description=doc.dc_title[1]||"";}
                        thumbnail = doc.thumbnail;
                        //doc.dc_format;
                        div = $("<div style='border-bottom:1px solid black; margin-bottom:1em;'/>");
                        div.attr("id", "s-"+id);
                        checkbox = $("<input type='checkbox' class='package-select' id='c-"+id+"' />");
                        if(packagedIds[id]){
                            checkbox.attr("checked", true);
                        }
                        h3 = $("<h3/>");
                        h3.append(checkbox);
                        h3.append(title);
                        //h3.append("<label for='c-"+ id +"'>" + title + "</label");
                        div.append(h3);
                        if(thumbnail){
                            var src = [portalPath, "download", id, thumbnail].join("/");
                            var img = $("<img src='"+src+"' />");
                            div.append(img);
                        }
                        div.append($("<p class='item-description'>"+description+"</p>"));
                        searchResultsDiv.append(div);
                        checkbox.click(function(){
                            if(checkbox.attr("checked")){
                                addItemToSet(id, title, description, thumbnail);
                            }else{
                                removeItemFromSet(id);
                            }
                        });
                    }catch(e){alert("ERROR:" + e)}
                });
            }
        );
        return false;
    }
    function addItemToSet(id, title, description, thumbnail){
        var packagedItems = packageData.packagedItems;
        var oid = packageData.oid;
        var obj;
        if(!description) description="";
        $.getJSON(wfUrl,
            {func:"addItem", oid:oid, id:id, title:title},
            function(data){

            }
        );
        obj = {id:id, title:title, description:description, thumbnail:thumbnail};
        packagedItems.push(obj);
    }
    function removeItemFromSet(id){
        var packagedItems = packageData.packagedItems;
        var oid = packageData.oid;
        $.getJSON(wfUrl,
            {func:"removeItem", oid:oid, id:id},
            function(data){

            }
        );
        $.each(packagedItems, function(i, v){
            if(v.id==id){
                packagedItems.splice(i, 1);
                $("#item-"+id).remove();
            }
        });
    }

</script>


