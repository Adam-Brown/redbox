#set($oid = $self.getFormData("oid"))
#set($title = $self.getFormData("title"))
#set($pageTitle = $title)
<style type="text/css">
.inputscreens input {
    margin: 0.5ex;
}

.inputscreens textarea {
    margin: 0.5ex;
}

.inputscreens table {
    margin: 0.5ex;
    margin-bottom: 2ex;
}

td.delete-row {
    cursor: pointer;
    color: blue;
}

.prev-tab,.next-tab, .form-fields-save {
    cursor: pointer;
    color: blue;
    margin: 1ex;
}

.saved-result {
    font-size: 120%;
    vertical-align: middle;
}

div.tab-nav {
    padding-top: 2ex;
}

img.thumbnail {
    height: 100px;
    border: 1px solid black;
    margin: 10px 5px 0 0;
}

div.accordion-header {
    padding-left: 4ex;
    margin: 0px;
}

h2.accordion-header {
    padding-left: 4ex;
    margin: 0px;
    background: gray;
}

div.accordion {
    margin-left: -1em;
    margin-bottom: 2em;
}

div.tab-nav {
    border-top: thin solid #CCC;
    padding-top: 2ex;
}

.box h2 {
    background: none;
    color: black;
    font-size: 1.1em;
    text-transform: none;
}

.helpWidget {
    color: blue;
    cursor:pointer;
    float: right;
}

</style>
<div class="grid_16">
    <div class="box">
        <div id="inputForms"><!-- --></div>
    </div>
</div>
<script type="text/javascript" src="$portalPath/js/jquery.cookie.js"></script>
<script type="text/javascript" src="$portalPath/javascript-widgets/widgets2.js"></script>
<script type="text/javascript" src="$portalPath/javascript-widgets/nameLookup.js"></script>
<script type="text/javascript">
// <![CDATA[
  var packageData = {
            portalPath:"$portalPath",
            metaData:$self.getJsonMetadata(),
            ajaxRequestUrl:"$self.getAjaxRequestUrl()",
            packagedItems:$self.getJsonPackagedItems(),
            test:$self.getJsonTest(),
            oid:"$oid"
        };
/*
$self.getSearchResults()
$self.userRoles()
$self.username()
$self.getCurrentStep()
*/
// ]]>
</script>
<script type="text/javascript" src="$portalPath/javascript-widgets/widgets2.js"></script>
<script type="text/javascript" src="$portalPath/javascript-widgets/nameLookup.js"></script>
<script type="text/javascript">
(function($){
    $(function(){
        function onContentLoaded(){
var pMsg=$("<p style='font-size:120%;color:green;'>Loading form data. Please wait...</p>");
$(".inputscreens").hide().after(pMsg);
            widgets.changeToTabLayout($(".inputscreens")).tabs({ "cookie": { "expires": 30 }});
            widgets.contentLoaded(function(){
                try{
                    var st=new Date(), et, ms;
                    widgets.formsById["main-form"].addListener("postOnRestore",
                        function(ctx){
                            ctx.findx(".lookup-show").each(function(){
                                var e=$(this);
                                e.find("a.nameLookup-lookup").text(e.find("input.nl").val()?"identified as:":"lookup");
                                e.find(".identified-as-name").text(e.find("input.nl").val());
                            });
                        }
                    );
                    widgets.formsById["main-form"].restore(packageData.metaData);
                    et=new Date(); ms=et-st;
                    //gdialog.text("restored in "+ms+"mS").dialog("open");
                    //
                    $(".accordion").accordion({header:".accordion-header", collapsible:true,
                            clearStyle:true, active:false});     // or active:2
                    //widgets.changeToTabLayout($(".inputscreens")).tabs();
                    //
                    var dcTitle=$("input[id=dc:title]"), title=$("#title");
                    dcTitle.change(function(){
                        title.text(dcTitle.val());
                    }).change();
pMsg.remove();
$(".inputscreens").show();
                }catch(e){alert(e);}
                //$("#getPackagedItems").click(getPackagedItems);
                //$("#add-items-search").click(function(){itemSearch(1); return false;});
                //$("#add-items-search-query").keypress(function(e){
                //    if(e.which==13) itemSearch(1);
                //});
                $("#deposit_accept_msg").text("$self.getNextStepAcceptMessage()");
                $(".validation-err-msg[for=deposit_accept]").text(
                        "$self.getNextStepAcceptValidationErrorMessage()");
                nameLookup.init();
                //$(".accordion").bind("accordionchangestart", function(e, ui){
                //    getPackagedItems();
                //});
            });
        }
        $("#inputForms").load(packageData.portalPath + "/workflows/forms/dataset", onContentLoaded);
        
        var vrl = jQuery("#view-record-link");
        vrl.attr("href", vrl.attr("href")+packageData.oid);
        vrl.click(function(){
            if(widgets.forms[0].hasChanges()){
                return confirm("Are you sure you want to leave this page without saving first!");
            }
        });
    });
})(jQuery);

function submitted_ok(){
    //alert("Submitted ok " + location.href);
    location.href = location.href.replace("/workflow/", "/detail/");
}

function convertOpenSearchToDropDown(data) {
    console.log(data)
}
</script>
<hr/>
