#set($noLayout = true)
#parseTemplate("workflows/forms/sections/navigation.vm")
<div class="widget-form" id="main-form"
     data-submit-result-func="submitted_ok"
     data-save-url="{packageData.portalPath}/workflow.ajax?func=update-package-meta&amp;oid={packageData.oid}"
     data-submit-url="{packageData.portalPath}/workflow.ajax?func=update-package-meta-deposit&amp;oid={packageData.oid}">
    <input type="hidden" class="form-fields" value="
        ## general
        dc:title,
        dc:coverage.from,
        dc:coverage.to,
        dc:created,
        dc:modified,
        time_period,
        dc:language,
        dc:language.skos:prefLabel,
        location,
        dc:type,
        ## description
        dc:description,
        citations.0,
        data,
        website,
        ## people
        dc:creator.foaf:Person.0.dc:identifier,
        dc:creator.foaf:Person.0.pi,
        dc:creator.foaf:Person.0.coPi,
        dc:creator.foaf:Person.0.foaf:givenName,
        dc:creator.foaf:Person.0.foaf:familyName,
        dc:creator.foaf:Person.0.association,
        dc:creator.foaf:Person.0.association.skos:prefLabel,
        primary_contact_name,
        primary_contact_email,
        supervisor,
        collaborators.0,
        ## subject
        dc:subject.anzsrc:seo.0.skos:prefLabel,
        dc:subject.anzsrc:seo.0.rdf:resource,
        dc:subject.anzsrc:for.0.skos:prefLabel,
        dc:subject.anzsrc:for.0.rdf:resource,
        dc:subject.keywords.0,
        research_activity,
        ## provenance
        sources_used,
        access_conditions,
        embargo_release,
        embargo_expiry,
        restrictions,
        license_cc,
        license_other,
        ## management
        url,
        physical_storage,
        retention_period,
        disposal_date,
        data_owner,
        data_custodian,
        affiliation.0,
        affiliation.0.skos:prefLabel,
        grant.0.uon:internal,
        grant.0.rdf:resource,
        grant.0.dc:identifier,
        grant.0.skos:prefLabel,
        funding.0,
        project_title,
        depositor,
        data_size,
        extent,
        policy,
        contracts,
        management_plan
    " />
    <input type="hidden" class="form-fields-readonly" value="xmlns:dc, xmlns:foaf, xmlns:anzsrc, metaList" />
    <input type="hidden" id="metaList" value="[]" />
    <input type="hidden" id="xmlns:dc" value="http://dublincore.org/documents/2008/01/14/dcmi-terms/" />
    <input type="hidden" id="xmlns:foaf" value="http://xmlns.com/foaf/spec/" />
    <input type="hidden" id="xmlns:anzsrc" value="http://purl.org/anzsrc/" />
    <div class="clear"></div>
    <h1 style="padding-bottom:1em;">
        <a id="view-record-link" style="float:right;padding-right:4px;font-size:0.6em;" href="$portalPath/detail/">View record</a>
        <span id="title"> </span>
    </h1>
    <div class="inputscreens changeToTabLayout">
        <h3><a href="#screen1">General</a></h3>
        <div id="screen1" class="inputscreen">
            #parseTemplate("workflows/forms/sections/general.vm")
            #nav(false true)
        </div>
        <h3><a href="#screen2">Description</a></h3>
        <div id="screen2" class="inputscreen">
            #parseTemplate("workflows/forms/sections/description.vm")
            #nav(true true)
        </div>
        <h3><a href="#screen3">People</a></h3>
        <div id="screen3" class="inputscreen">
            #parseTemplate("workflows/forms/sections/people.vm")
            #nav(true true)
        </div>
        <h3><a href="#screen4">Subject</a></h3>
        <div id="screen4" class="inputscreen">
            #parseTemplate("workflows/forms/sections/subject.vm")
            #nav(true true)
        </div>
        <h3><a href="#screen5">Provenance</a></h3>
        <div id="screen5" class="inputscreen">
            #parseTemplate("workflows/forms/sections/provenance.vm")
            #nav(true true)
        </div>
        <h3><a href="#screen6">Management</a></h3>
        <div id="screen6" class="inputscreen">
            #parseTemplate("workflows/forms/sections/management.vm")
            #nav(true true)
        </div>
        <h3><a href="#screen7">Submit</a></h3>
        <div id="screen7" class="inputscreen">
            #parseTemplate("workflows/forms/sections/submit.vm")
            #nav(true false)
        </div>
    </div>
##    <span class="saved-result"></span>
</div>
<script type="text/javascript">
$(function(){
    $("#title").html("Stage: " + packageData.stageLabel);
    $("#view-record-link").click(function(){
        var href = $(this).attr("href");
        $(this).attr("href", href+packageData.oid);
        if(widgets.forms[0].hasChanges()){
            return confirm("Are you sure you want to leave this page without saving first!");
        }
    });
    $(".tab-nav .next-tab,.tab-nav .prev-tab").click(function(){
        if(widgets.forms[0].hasChanges()){
            $(".form-fields-save").click();
        }
    });
    $(".form-fields-save").click(function(){
        $(".saved-result").html("<img src='../images/loading-progress.gif'/>").show();
    });
});
</script>
